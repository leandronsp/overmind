#!/bin/sh
set -e

SOCK="$HOME/.overmind/overmind.sock"
SCRIPT="$0"
[ -L "$SCRIPT" ] && SCRIPT="$(readlink "$SCRIPT")"
BASEDIR="$(cd "$(dirname "$SCRIPT")" && pwd)"
DAEMON="$(cd "$BASEDIR/.." && pwd)/overmind_daemon"
PIDFILE="$HOME/.overmind/daemon.pid"
LOGFILE="$HOME/.overmind/daemon.log"

. "$BASEDIR/cli/helpers.sh"
. "$BASEDIR/cli/commands.sh"
. "$BASEDIR/cli/orchestration.sh"

case "${1:-}" in
  start)       cmd_start ;;
  shutdown)    cmd_shutdown ;;
  run)         shift; cmd_run "$@" ;;
  claude)
    if [ "${2:-}" = "run" ]; then
      shift 2; cmd_claude_run "$@"
    else
      echo "Unknown command: claude $2"
      usage
    fi
    ;;
  ps)          shift; cmd_ps "$@" ;;
  info)        cmd_info "$2" ;;
  logs)        cmd_logs "$2" ;;
  stop)        cmd_stop "$2" ;;
  kill)        shift; cmd_kill "$@" ;;
  wait)        shift; cmd_wait "$@" ;;
  send)        shift; cmd_send "$@" ;;
  attach)      cmd_attach "$2" ;;
  detach)      cmd_detach "$2" ;;
  "")          usage ;;
  *)           echo "Unknown command: $1"; usage ;;
esac
